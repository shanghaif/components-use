(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-6908"],{"2I5+":function(e,t,a){"use strict";var n=a("OPPv");a.n(n).a},CQeZ:function(e,t,a){"use strict";a.r(t);var n=a("gDS+"),s=a.n(n),i=a("fe1z"),o=a("v0iw"),r={data:function(){return{formLabelWidth:"120px",roleEdit:!1,form:{name:"",alias:"",desc:""},data:[],dialogVisible:!1,multipleSelection:[],search:"",total:0,pagesize:10,start:0,tableData:[],update:0,id:"",row:"",insert:[],roles1:[],tableDataroles:[],centerDialogVisible:!1,originrole:[],orderresultes:[],depandmenu:[],rolemenu:[],rolemenuname:"",roleobjectid:"",rolecontrol:!0,roledata:[],rolecontroldata:[],data1:[],editroleid:""}},computed:{treeData:function(){var e=JSON.parse(s()(this.data1));return e.filter(function(t){var a=e.filter(function(e){return t.objectId==e.parent});return a.length>0&&(t.children=a),0==t.parent})},menudata:function(){var e=JSON.parse(s()(this.data));return e.filter(function(t){var a=e.filter(function(e){return t.objectId==e.parent});return a.length>0&&(t.children=a),0==t.parent})}},mounted:function(){this.gettable(this.pagesize,this.start),this.getMenu(),this.getRoleschema()},methods:{getMenu:function(){var e=this;this.data=[];var t=o.Parse.Object.extend("Menu");new o.Parse.Query(t).find().then(function(t){t.map(function(t){var a={};a.label=t.attributes.name,a.objectId=t.id,a.parent=t.attributes.parent.id,a.createtime=new Date(t.attributes.createdAt).toLocaleDateString(),e.data.push(a)})},function(t){console.log(t),"209"==t.code&&(e.$message({type:"warning",message:"登陆权限过期，请重新登录"}),e.$router.push({path:"/login"}))})},diguiquchu:function(e,t,a,n){var s=this;t.map(function(t){t.key==a&&t.children.length>0?(n.push(a),s.diguiquchu(e,t.children,a,n)):t.key!=a&&t.children.length>0&&s.diguiquchu(e,t.children,a,n)})},add:function(){this.$router.push({path:"/roles/editroles",query:{insert:0}})},handleSelectionChange:function(e){this.multipleSelection=e},addacl:function(){var e=this,t=o.Parse.Object.extend("_Role");new o.Parse.Query(t).get(this.objectId).then(function(t){var a=new o.Parse.ACL;e.multipleSelection.map(function(e){a.setRoleReadAccess(e.attributes.name,!0),a.setRoleWriteAccess(e.attributes.name,!0),t.set("ACL",a)}),t.save().then(function(t){e.$message({type:"success",message:"添加成功!"}),e.centerDialogVisible=!1,e.gettable(e.pagesize,e.start)},function(e){console.log(e)})})},handleClose:function(){this.dialogVisible=!1},handleDelete:function(e){var t=this,a=o.Parse.Object.extend("_Role");new o.Parse.Query(a).get(e).then(function(e){e.destroy().then(function(e){t.gettable(t.pagesize,t.start)},function(e){console.error("Error while deleting User",e)})})},addmenu:function(e){this.rolename=e.attributes.name,this.getMenu()},getDetailmenu:function(e){var t=this;this.rolecontrol=!1,this.rolemenuname=e.attributes.name,this.rolemenu=[],this.roleobjectid=e.id,this.rolecontroldata=[];var a=o.Parse.Object.extend("Menu"),n=new o.Parse.Query(a);n.ascending("createdAt"),n.find().then(function(e){e.map(function(e){0!=e.attributes.parentId&&e.attributes.ACL.permissionsById["role:"+t.rolemenuname]&&t.rolemenu.push(e.id)}),t.$refs.tree.setCheckedKeys(t.rolemenu)});var s=o.Parse.Object.extend("Permission"),i=new o.Parse.Query(s);i.ascending("createdAt"),i.limit(1e3),i.find().then(function(e){var a=t;e.map(function(e){0!=e.attributes.parent.id&&e.attributes.ACL.permissionsById["role:"+a.rolemenuname]&&a.rolecontroldata.push(e.id),a.$refs.tree1.setCheckedKeys(a.rolecontroldata)})})},getCheckedKeys:function(){var e=this,t=this.$refs.tree.getCheckedKeys().concat(this.$refs.tree.getHalfCheckedKeys());Object(i.c)(this.rolemenuname,t).then(function(t){t&&e.$message({type:"success",message:"添加成功!"})})},controlroles:function(){var e=this,t=this.$refs.tree1.getCheckedKeys().concat(this.$refs.tree1.getHalfCheckedKeys());Object(i.d)(this.rolemenuname,t).then(function(t){t&&e.$message({type:"success",message:"添加成功!"})})},gettable:function(e,t){var a=this;this.tableData=[];var n=o.Parse.Object.extend("_Role"),s=new o.Parse.Query(n);s.limit(e),s.skip(t),s.count().then(function(e){e&&(a.total=e),s.find().then(function(e){a.tableData=e},function(e){console.log(e),"209"==e.code&&(a.$message({type:"warning",message:"登陆权限过期，请重新登录"}),a.$router.push({path:"/login"}))})})},handleSizeChange:function(e){this.pagesize=e,this.gettable(this.pagesize,this.start)},handleCurrentChange:function(e){this.start=Number(e-1)*Number(this.pagesize),this.gettable(this.pagesize,this.start)},handleCheckChange:function(e,t){console.log(e,t)},searchvalue:function(){var e=this;this.tableData=[];var t=o.Parse.Object.extend("_Role"),a=new o.Parse.Query(t);a.equalTo("name",this.search),a.limit(this.pagesize),a.count().then(function(t){t&&(e.total=t,a.find().then(function(t){e.tableData=t}))})},getRoleschema:function(){var e=this,t=o.Parse.Object.extend("Permission"),a=new o.Parse.Query(t);a.limit(1e3),a.find().then(function(t){t.map(function(t){var a={};a.label=t.attributes.alias,a.alias=t.attributes.name,a.objectId=t.id,a.parent=t.attributes.parent.id,a.createtime=new Date(t.attributes.createdAt).toLocaleDateString(),e.data1.push(a)})})},handleEditrole:function(e){var t=this;this.editroleid=e.id;var a=o.Parse.Object.extend("_Role");new o.Parse.Query(a).get(e.id).then(function(e){t.roleEdit=!0,t.form.name=e.attributes.name,t.form.desc=e.attributes.desc,t.form.alias=e.attributes.alias,console.log(e)})},updaterole:function(){var e=this,t=o.Parse.Object.extend("_Role");new o.Parse.Query(t).get(this.editroleid).then(function(t){t.set("alias",e.form.alias),t.set("desc",e.form.desc),t.save().then(function(t){e.$message({type:"success",message:"更新成功"})}),e.roleEdit=!1,e.gettable(e.pagesize,e.start)})}}},l=(a("ISVi"),a("2I5+"),a("KHd+")),c=Object(l.a)(r,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"roles"},[a("div",{staticClass:"search"},[a("el-input",{attrs:{placeholder:"请输入内容",clearable:""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}}),e._v(" "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.searchvalue}},[e._v("搜 索")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.add}},[e._v("新 增")])],1),e._v(" "),a("div",{staticClass:"tableroles",staticStyle:{"margin-top":"20px"}},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tableData,"highlight-current-row":""},on:{"row-click":e.getDetailmenu}},[a("el-table-column",{attrs:{label:"名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"描述",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.alias))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.id))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"success",icon:"el-icon-edit"},on:{click:function(a){e.handleEditrole(t.row)}}},[e._v("编 辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete"},on:{click:function(a){e.handleDelete(t.row)}}},[e._v("删 除")])]}}])})],1),e._v(" "),a("div",{staticClass:"block",staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[1,5,10],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"增加权限",visible:e.centerDialogVisible,width:"50%"},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("el-table",{ref:"multipleTable",staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.tableDataroles},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"描述",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.desc))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.id))])]}}])})],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.addacl}},[e._v("确 认")])],1)],1),e._v(" "),a("div",{staticClass:"rolefooter"},[a("div",{staticClass:"footerleft"},[a("p",{staticClass:"top"},[a("span",[e._v("权限分配")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-success",disabled:e.rolecontrol},on:{click:e.controlroles}},[e._v("保 存")])],1),e._v(" "),a("div",{staticClass:"rolecontrol"},[a("el-tree",{ref:"tree1",attrs:{data:e.treeData,"show-checkbox":"","node-key":"objectId",defaultProps:"",accordion:"","default-checked-keys":e.rolecontroldata,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(n.label))])])}}])})],1)]),e._v(" "),a("div",{staticClass:"footerright"},[a("p",{staticClass:"top"},[a("span",[e._v("菜单分配")]),e._v(" "),a("el-button",{attrs:{type:"primary",icon:"el-icon-success",disabled:e.rolecontrol},on:{click:e.getCheckedKeys}},[e._v("保 存")])],1),e._v(" "),a("div",{staticClass:"menucontrol",staticStyle:{"margin-top":"30px"}},[a("el-tree",{ref:"tree",attrs:{data:e.menudata,"show-checkbox":"","node-key":"objectId",defaultProps:"",accordion:"","default-checked-keys":e.rolemenu,"expand-on-click-node":!1},scopedSlots:e._u([{key:"default",fn:function(t){var n=t.node;return a("span",{staticClass:"custom-tree-node"},[a("span",[e._v(e._s(n.label))])])}}])})],1)])]),e._v(" "),a("el-dialog",{attrs:{title:"编辑角色",visible:e.roleEdit},on:{"update:visible":function(t){e.roleEdit=t}}},[a("el-form",{attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"角色名称","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",disabled:""},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色备注","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off"},model:{value:e.form.alias,callback:function(t){e.$set(e.form,"alias",t)},expression:"form.alias"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"角色描述","label-width":e.formLabelWidth}},[a("el-input",{staticStyle:{width:"300px"},attrs:{autocomplete:"off",type:"textarea",rows:2},model:{value:e.form.desc,callback:function(t){e.$set(e.form,"desc",t)},expression:"form.desc"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.roleEdit=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.updaterole}},[e._v("确 定")])],1)],1)],1)},[],!1,null,"31f75432",null);c.options.__file="roles.vue";t.default=c.exports},ISVi:function(e,t,a){"use strict";var n=a("Tgro");a.n(n).a},OPPv:function(e,t,a){},Tgro:function(e,t,a){}}]);