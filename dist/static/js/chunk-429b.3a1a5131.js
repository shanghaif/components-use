(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-429b"],{"0mDb":function(e,t,n){},OaIt:function(e,t,n){"use strict";var i=n("0mDb");n.n(i).a},UNpt:function(e,t,n){"use strict";n.r(t);var i=n("v0iw"),a=n.n(i),s=n("S+eF"),o=(n("URgk"),{data:function(){return{height:document.documentElement.clientHeight-180+"px;",delLoading:!1,sup_this:this,loading:!1,deptName:"",depts:[],deptId:null,structure:[],defaultProps:{children:"children",label:"name"},data:[],dataforuser:[],total:0,query:{value:"",type:"",enabled:""},tableData:[],pagesize:10,start:0,departmentid:[],userlist:[],rolelist:[],objectId:"",roleacl:!1,multipleSelection:[],userrolelist:[]}},mounted:function(){this.userFordepartment()},methods:{editorrole:function(e){var t=this;this.userrolelist=[],this.objectId=e,this.roleacl=!0;var n=a.a.Object.extend("_User");new a.a.Query(n).get(this.objectId).then(function(e){var i=a.a.Object.extend("_Role"),s=new a.a.Query(i),o=new n;s.addAscending("createdAt"),s.find().then(function(e){t.rolelist=e,o.set("objectId",t.objectId),s.equalTo("users",o),s.find().then(function(n){n.map(function(n){e.map(function(e,i){n.id==e.id&&(t.$refs.multipleTable.toggleRowSelection(t.rolelist[i],!0),t.userrolelist.push(e.id))})})})})})},seleItem:function(e,t,n){e.map(function(e){t.includes(e)||n.push(e)}),t.map(function(t){e.includes(t)||n.push(t)}),this.userRolereset(n)},userRolereset:function(e){var t=this;s.Promise.all([e.map(function(e){t.testroles(e)})]).then(function(e){0!=e.length&&(t.$message({type:"success",message:"分配成功"}),t.roleacl=!1)})},testroles:function(e){console.log(e);var t=new(a.a.Object.extend("_Role")),n=new(a.a.Object.extend("_User"));if(t.id=e,this.multipleSelection.includes(e)){var i=t.relation("users");n.set("objectId",this.objectId),i.add(n),t.save().then(function(e){})}else{i=t.relation("users");n.set("objectId",this.objectId),i.remove(n),t.save().then(function(e){})}},adduseracl:function(){this.seleItem(this.userrolelist,this.multipleSelection,[])},handleSelectionChange:function(e){var t=this;this.multipleSelection=[],e.map(function(e){t.multipleSelection.push(e.id)})},handleEditor:function(e){this.$router.push({path:"/roles/edituser",query:{id:e.id}})},handleDetele:function(e){var t=this;console.log(e),this.$confirm("此操作将永久删除此用户, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var n=a.a.Object.extend("_User");new a.a.Query(n).get(e.id).then(function(e){e.destroy().then(function(e){t.$message({type:"success",message:"删除成功!"}),t.userFordepartment()},function(e){console.log(e)})})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},handleSizeChange:function(e){this.pagesize=e,this.userFordepartment()},handleCurrentChange:function(e){this.start=Number(e-1)*Number(this.pagesize),this.userFordepartment()},userFordepartment:function(){var e=this;this.tableData=[];var t=a.a.Object.extend("_User"),n=new a.a.Query(t);""!=this.query.value&&(n.equalTo("username",this.query.value),this.pagesize=10,this.start=0),n.limit(this.pagesize),n.skip(this.start),n.count().then(function(t){t?(e.total=t,n.find().then(function(t){t.map(function(t){var n={attributes:{}};n.attributes.username=t.attributes.username,n.attributes.phone=t.attributes.phone,n.attributes.email=t.attributes.email,n.attributes.departmentname=t.attributes.departmentname,n.attributes.emailVerified=t.attributes.emailVerified,n.createdAt=t.createdAt,n.id=t.id,e.tableData.push(n)})})):(e.dataforuser=[],e.total=0)})},adduser:function(){this.$router.push({path:"/roles/adduser"})},changerole:function(e,t){var n=this,i="",s="",o=!0;1==t.attributes.emailVerified?(i="禁用",o=!1,s="warning"):(i="启用",s="success",o=!0),this.$confirm("是否"+i,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:s}).then(function(){var e=a.a.Object.extend("_User");new a.a.Query(e).get(t.id).then(function(e){e.set("emailVerified",o),e.save().then(function(e){e&&n.$message({type:"success",message:"已"+i}),n.getDepartment()},function(e){console.log(e),119==e.code&&n.$message({type:"error",message:e.message})})})}).catch(function(){n.$message({type:"info",message:"已取消"})})}}}),l=(n("WALf"),n("OaIt"),n("KHd+")),r=Object(l.a)(o,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"structure"},[n("el-row",{attrs:{gutter:20}},[n("el-col",{attrs:{xs:24,sm:24,md:24,lg:24,xl:24}},[n("el-input",{staticClass:"filter-item",staticStyle:{width:"200px"},attrs:{clearable:"",placeholder:"输入用户名称搜索"},model:{value:e.query.value,callback:function(t){e.$set(e.query,"value",t)},expression:"query.value"}}),e._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-search"},on:{click:e.userFordepartment}},[e._v("搜索")]),e._v(" "),n("el-button",{staticClass:"filter-item",attrs:{type:"primary",icon:"el-icon-circle-plus"},on:{click:e.adduser}},[e._v("新增用户")]),e._v(" "),n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%","margin-top":"20px"},attrs:{data:e.tableData,size:"small"}},[n("el-table-column",{attrs:{label:"用户名"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v(e._s(t.row.attributes.username))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"电话"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v(e._s(t.row.attributes.phone))])]}}])}),e._v(" "),n("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"邮箱"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v(e._s(t.row.attributes.email))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"部门"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",[e._v(e._s(t.row.departmentname))])]}}])}),e._v(" "),n("el-table-column",{attrs:{"show-overflow-tooltip":!0,label:"创建日期"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(new Date(t.row.createdAt).toLocaleDateString()))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",align:"center",width:"400"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.attributes.emailVerified?n("el-button",{attrs:{type:"success",size:"small"},on:{click:function(n){e.changerole(t.$index,t.row)}}},[n("div",{staticStyle:{width:"10px",height:"10px","border-radius":"50%",display:"inline-block",background:"#00cc33","margin-right":"10px"}}),e._v("启用\n            ")]):e._e(),e._v(" "),1==t.row.attributes.emailVerified?n("el-button",{attrs:{type:"info",size:"small"},on:{click:function(n){e.changerole(t.$index,t.row)}}},[n("div",{staticStyle:{width:"10px",height:"10px","border-radius":"50%",display:"inline-block",background:"#a94442","margin-right":"10px"}}),e._v("禁用\n            ")]):e._e(),e._v(" "),n("el-button",{attrs:{type:"success",size:"small"},on:{click:function(n){e.handleEditor(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-button",{attrs:{type:"danger",size:"small"},on:{click:function(n){e.handleDetele(t.row)}}},[e._v("删除")]),e._v(" "),n("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(n){e.editorrole(t.row.id)}}},[e._v("分配角色")])]}}])})],1),e._v(" "),n("el-pagination",{staticStyle:{"margin-top":"8px"},attrs:{total:e.total,layout:"total, prev, pager, next, sizes","page-sizes":[1,5,10],"page-size":e.pagesize},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:"分配角色",visible:e.roleacl},on:{"update:visible":function(t){e.roleacl=t}}},[n("el-table",{ref:"multipleTable",attrs:{data:e.rolelist},on:{"selection-change":e.handleSelectionChange}},[n("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),n("el-table-column",{attrs:{label:"名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"描述",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.desc))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"ID",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.id))])]}}])})],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.roleacl=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.adduseracl}},[e._v("确 定")])],1)],1)],1)],1)},[],!1,null,"36c4ef16",null);r.options.__file="structure.vue";t.default=r.exports},URgk:function(e,t,n){(function(e){var i=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(a.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new s(a.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},n("YBdB"),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,n("yLpj"))},WALf:function(e,t,n){"use strict";var i=n("fbzf");n.n(i).a},YBdB:function(e,t,n){(function(e,t){!function(e,n){"use strict";if(!e.setImmediate){var i,a=1,s={},o=!1,l=e.document,r=Object.getPrototypeOf&&Object.getPrototypeOf(e);r=r&&r.setTimeout?r:e,"[object process]"==={}.toString.call(e.process)?i=function(e){t.nextTick(function(){u(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}()?function(){var t="setImmediate$"+Math.random()+"$",n=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&u(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",n,!1):e.attachEvent("onmessage",n),i=function(n){e.postMessage(t+n,"*")}}():e.MessageChannel?function(){var e=new MessageChannel;e.port1.onmessage=function(e){u(e.data)},i=function(t){e.port2.postMessage(t)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var e=l.documentElement;i=function(t){var n=l.createElement("script");n.onreadystatechange=function(){u(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}():i=function(e){setTimeout(u,0,e)},r.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),n=0;n<t.length;n++)t[n]=arguments[n+1];var o={callback:e,args:t};return s[a]=o,i(a),a++},r.clearImmediate=c}function c(e){delete s[e]}function u(e){if(o)setTimeout(u,0,e);else{var t=s[e];if(t){o=!0;try{!function(e){var t=e.callback,i=e.args;switch(i.length){case 0:t();break;case 1:t(i[0]);break;case 2:t(i[0],i[1]);break;case 3:t(i[0],i[1],i[2]);break;default:t.apply(n,i)}}(t)}finally{c(e),o=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,n("yLpj"),n("8oxB"))},fbzf:function(e,t,n){}}]);