(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-761e"],{28:function(e,a){},29:function(e,a){},"3mMa":function(e,a,n){"use strict";var t=n("D6zB");n.n(t).a},D6zB:function(e,a,n){},N0PP:function(e,a,n){"use strict";n.r(a);var t=n("v0iw"),l=n.n(t),s=(n("1IWx"),{data:function(){return{innerVisible:!1,allProductData:[],allProductlength:10,allProductstart:0,allProducttotal:0,productData:[],channelProductdialog:!1,productstart:0,productlength:10,producttotal:0,total:0,start:0,length:10,tableData:[],activeName:"first",channelregion:[{name:"HTTP",value:"HTTP",channeltype:"采集通道",channelvalue:"1"},{name:"TCP",value:"TCP",channeltype:"采集通道",channelvalue:"1"},{name:"UDP",value:"UDP",channeltype:"采集通道",channelvalue:"1"},{name:"MQTT",value:"MQTT",channeltype:"采集通道",channelvalue:"1"},{name:"MQTTCLI",value:"MQTTCLI",channeltype:"采集通道",channelvalue:"1"},{name:"Tdengine",value:"Tdengine",channeltype:"资源通道",channelvalue:"2"}],channelformsearch:{name:""},channelForm:!1,addchannel:{name:"",region:"HTTP",topic:"",port:"",channeltype:"",ip:"0.0.0.0",path:"",client:"",desc:"",auto_save:30,max_size:1e4,max_memory:1024e3,server:"",username:"",password:"",isEnable:!1,buff_size:1024e3,address:"",clean_start:!1,ssl:!1,keepalive:""},pwdType:"password",channelId:"",addrules:{name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}],channeltype:[{required:!0,message:"请选择通道类型",trigger:"change"}]},productIds:[],channelupdated:""}},mounted:function(){this.getChannel()},methods:{showPwd:function(){"password"===this.pwdType?this.pwdType="":this.pwdType="password"},getChannelEnable:function(e,a){return 1==e.row.attributes.isEnable?"green_active":"red_active"},utc2beijing:function(e){return new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")},addchanneltype:function(){this.channelForm=!0,this.channelupdated="新增"},getChannel:function(e){var a=this;0==e&&(this.start=0);var n=l.a.Object.extend("Channel"),t=new l.a.Query(n);""!=this.channelformsearch.name&&t.equalTo("name",this.channelformsearch.name),t.ascending("-createdAt"),t.skip(this.start),t.limit(this.length),t.count().then(function(e){a.total=e,t.find().then(function(e){e&&(a.tableData=e)})},function(e){a.$message.error(e.message)})},channelSizeChange:function(e){this.length=e,this.getChannel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.getChannel()},addchannelForm:function(e){var a=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;a.channelregion.map(function(e){e.name==a.addchannel.region&&(a.addchannel.channeltype=e.channelvalue)});var n=l.a.Object.extend("Channel"),t=new l.a.Query(n);t.equalTo("config.port",a.addchannel.port),t.find().then(function(e){var t=new n;""!=a.channelId?t.id=a.channelId:0==e.length||a.$message({type:"warning",message:"此端口已存在"}),t.set("name",a.addchannel.name),t.set("cType",a.addchannel.region),t.set("type",a.addchannel.channeltype),t.set("desc",a.addchannel.desc),t.set("isEnable",a.addchannel.isEnable),"UDP"==a.addchannel.region?t.set("config",{port:a.addchannel.port}):"TCP"==a.addchannel.region?t.set("config",{port:a.addchannel.port,buff_size:a.addchannel.buff_size}):"MQTT"==a.addchannel.region?t.set("config",{topic:a.addchannel.topic,client:a.addchannel.client}):"HTTP"==a.addchannel.region?t.set("config",{path:"http://"+a.addchannel.path,port:a.addchannel.port}):"Tdengine"==a.addchannel.region?t.set("config",{auto_save:a.addchannel.auto_save,max_size:a.addchannel.max_size,max_memory:a.addchannel.max_memory,server:"http://"+a.addchannel.server,username:a.addchannel.username,password:a.addchannel.password}):"MQTTCLI"==a.addchannel.region&&t.set("config",{address:a.addchannel.address,port:a.addchannel.port,username:a.addchannel.username,password:a.addchannel.password,clean_start:a.addchannel.clean_start,ssl:a.addchannel.ssl,keepalive:a.addchannel.keepalive}),t.save().then(function(e){e&&(a.$message({type:"success",message:"成功"}),a.addchannel={name:"",region:"HTTP",topic:"",port:"",channeltype:"",auto_save:"",max_size:"",max_memory:"",server:"",username:"",password:"",desc:"",buff_size:"",path:"",isEnable:!1,ip:"0.0.0.0",address:"",clean_start:!1,ssl:!1,keepalive:""},a.channelForm=!1,a.channelId="",a.getChannel())},function(e){a.$message({type:"error",message:e.message})})})})},handleClose:function(){this.addchannel={name:"",region:"HTTP",topic:"",port:"",channeltype:"",ip:"0.0.0.0",path:"",client:"",auto_save:"",max_size:"",max_memory:"",server:"",username:"",password:"",desc:"",buff_size:"",isEnable:!1,address:"",clean_start:!1,ssl:!1,keepalive:""},this.channelForm=!1,this.channelId=""},qyChannel:function(e){var a=this,n=new(l.a.Object.extend("Channel"));n.id=e.id,n.set("isEnable",!e.attributes.isEnable),n.save().then(function(e){e&&(a.$message({type:"success",message:"状态修改成功"}),a.getChannel())},function(e){a.$message({type:"error",message:e.message})})},updateChannel:function(e){this.channelForm=!0,this.channelupdated="编辑",this.addchannel.name=e.attributes.name,this.addchannel.region=e.attributes.cType,"MQTT"==e.attributes.cType?(this.addchannel.topic=e.attributes.config.topic,this.addchannel.client=e.attributes.config.client):"HTTP"==e.attributes.cType?this.addchannel.path=e.attributes.config.path:"Tdengine"==e.attributes.cType?(this.addchannel.auto_save=e.attributes.config.auto_save,this.addchannel.max_size=e.attributes.config.max_size,this.addchannel.max_memory=e.attributes.config.max_memory,this.addchannel.server=e.attributes.config.server.substring(7),this.addchannel.username=e.attributes.config.username,this.addchannel.password=e.attributes.config.password):"TCP"==e.attributes.cType?this.addchannel.buff_size=e.attributes.config.buff_size:"MQTTCLI"==e.attributes.cType&&(this.addchannel.address=e.attributes.config.address,this.addchannel.username=e.attributes.config.username,this.addchannel.password=e.attributes.config.password,this.addchannel.clean_start=e.attributes.config.clean_start,this.addchannel.ssl=e.attributes.config.ssl,this.addchannel.keepalive=e.attributes.config.keepalive),this.addchannel.ip="0.0.0.0",this.addchannel.port=e.attributes.config.port,this.addchannel.desc=e.attributes.desc,this.addchannel.channeltype=e.attributes.type,this.addchannel.isEnable=e.attributes.isEnable,this.channelId=e.id},deleteChannel:function(e){var a=this,n=new(l.a.Object.extend("Channel"));n.id=e.row.id,n.destroy().then(function(n){a.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-"+e.$index].doClose(),a.getChannel()},function(e){a.$message({type:"error",message:e.message})})}}}),r=(n("3mMa"),n("KHd+")),c=Object(r.a)(s,function(){var e=this,a=e.$createElement,n=e._self._c||a;return n("div",{staticClass:"channelmanage"},[n("h3",[e._v("服务通道管理")]),e._v(" "),n("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(a){e.activeName=a},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"设备通道("+e.total+")",name:"first"}},[n("div",{staticClass:"firsttable"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入通道名称"},model:{value:e.channelformsearch.name,callback:function(a){e.$set(e.channelformsearch,"name",a)},expression:"channelformsearch.name"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(a){e.getChannel(0)}}},[e._v("搜 索")])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:e.addchanneltype}},[e._v("创建通道")])],1)],1)],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,"row-class-name":e.getChannelEnable}},[n("el-table-column",{attrs:{label:"通道编号"},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v(e._s(a.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道名称"},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v(e._s(a.row.attributes.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.attributes.type?n("span",[e._v("采集通道")]):n("span",[e._v("资源通道")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"服务类型"},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v(e._s(a.row.attributes.cType))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道状态"},scopedSlots:e._u([{key:"default",fn:function(a){return[1==a.row.attributes.isEnable?n("span",{staticStyle:{color:"green"}},[e._v("已启用")]):n("span",[e._v("已禁用")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道地址",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v(e._s("channel/"+a.row.id))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"描述"},scopedSlots:e._u([{key:"default",fn:function(a){return[n("span",[e._v(e._s(a.row.attributes.desc))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(a){return[0==a.row.attributes.isEnable?n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){e.qyChannel(a.row)}}},[e._v("启用")]):n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){e.qyChannel(a.row)}}},[e._v("禁用")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.updateChannel(a.row)}}},[e._v("编辑")]),e._v(" "),n("el-popover",{ref:"popover-"+a.$index,attrs:{placement:"top",width:"300"}},[n("p",[e._v("确定删除这个"+e._s(a.row.attributes.name)+"通道吗？")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini"},on:{click:function(e){a._self.$refs["popover-"+a.$index].doClose()}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.deleteChannel(a)}}},[e._v("确定")])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),n("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[n("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.channelSizeChange,"current-change":e.channelCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:e.channelupdated+"服务通道",visible:e.channelForm,width:"40%",top:"5vh","before-close":e.handleClose},on:{"update:visible":function(a){e.channelForm=a}}},[n("el-form",{ref:"addchannel",attrs:{model:e.addchannel,"label-width":"100px",rules:e.addrules}},[n("el-form-item",{staticClass:"lastchildren",attrs:{label:"服务类型",prop:"region"}},[n("el-select",{attrs:{placeholder:"请选择服务类型",disabled:""!=e.channelId},model:{value:e.addchannel.region,callback:function(a){e.$set(e.addchannel,"region",a)},expression:"addchannel.region"}},e._l(e.channelregion,function(e,a){return n("el-option",{key:a,attrs:{label:e.name+e.channeltype,value:e.value}})}))],1),e._v(" "),n("el-form-item",{staticClass:"lastchildren",attrs:{label:"通道名称",prop:"name"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入通道名称"},model:{value:e.addchannel.name,callback:function(a){e.$set(e.addchannel,"name",a)},expression:"addchannel.name"}})],1),e._v(" "),"UDP"==e.addchannel.region||"TCP"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"IP"}},[n("el-input",{attrs:{autocomplete:"off",disabled:""},model:{value:e.addchannel.ip,callback:function(a){e.$set(e.addchannel,"ip",a)},expression:"addchannel.ip"}})],1):e._e(),e._v(" "),"UDP"==e.addchannel.region||"TCP"==e.addchannel.region||"HTTP"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"端口",prop:"port",rules:[{required:!0,trigger:"blur"},{validator:e.validPort}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入通道端口"},model:{value:e.addchannel.port,callback:function(a){e.$set(e.addchannel,"port",a)},expression:"addchannel.port"}})],1):e._e(),e._v(" "),"TCP"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"缓存限定",prop:"buff_size",rules:[{required:!0,message:"最大存储不能为空",trigger:"blur"},{type:"number",message:"最大存储必须为数字值"}]}},[n("el-input",{attrs:{autocomplete:"off",min:1},model:{value:e.addchannel.buff_size,callback:function(a){e.$set(e.addchannel,"buff_size",e._n(a))},expression:"addchannel.buff_size"}},[n("template",{slot:"append"},[e._v("KB")])],2)],1):e._e(),e._v(" "),"HTTP"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"路径",prop:"path",rules:[{required:!0,message:"需要输入正确的url",trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入通道路径"},model:{value:e.addchannel.path,callback:function(a){e.$set(e.addchannel,"path",a)},expression:"addchannel.path"}})],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"lastchildren",attrs:{label:"服务链接",prop:"server",rules:[{required:!0,message:"需要输入正确的url",trigger:"blur"},{validator:e.validUrl,trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入存储服务器地址"},model:{value:e.addchannel.server,callback:function(a){e.$set(e.addchannel,"server",a)},expression:"addchannel.server"}},[n("template",{slot:"prepend"},[e._v("http://")])],2)],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"库登录账号",prop:"username",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入用户名"},model:{value:e.addchannel.username,callback:function(a){e.$set(e.addchannel,"username",a)},expression:"addchannel.username"}})],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"库登录密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入密码",type:e.pwdType},model:{value:e.addchannel.password,callback:function(a){e.$set(e.addchannel,"password",a)},expression:"addchannel.password"}},[n("template",{slot:"append"},[n("span",{staticClass:"show-pwd",staticStyle:{cursor:"pointer"},on:{click:e.showPwd}},[n("svg-icon",{attrs:{"icon-class":"password"==e.pwdType?"eye":"zheneys"}})],1)])],2)],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"同步间隔",prop:"auto_save",rules:[{required:!0,message:"同步间隔不能为空",trigger:"blur"},{type:"number",message:"同步间隔必须为数字值"}]}},[n("el-input",{attrs:{autocomplete:"off",min:1,placeholder:"按照服务器配置建议（30-600）"},model:{value:e.addchannel.auto_save,callback:function(a){e.$set(e.addchannel,"auto_save",e._n(a))},expression:"addchannel.auto_save"}},[n("template",{slot:"append"},[e._v("秒")])],2)],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"缓存数据量",prop:"max_size",rules:[{required:!0,message:"最大条数不能为空",trigger:"blur"},{type:"number",message:"最大条数必须为数字值"}]}},[n("el-input",{attrs:{autocomplete:"off",min:1,placeholder:"达到设定值后进行存库操作"},model:{value:e.addchannel.max_size,callback:function(a){e.$set(e.addchannel,"max_size",e._n(a))},expression:"addchannel.max_size"}},[n("template",{slot:"append"},[e._v("条")])],2)],1):e._e(),e._v(" "),"Tdengine"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"缓存限定",prop:"max_memory",rules:[{required:!0,message:"最大存储不能为空",trigger:"blur"},{type:"number",message:"最大存储必须为数字值"}]}},[n("el-input",{attrs:{autocomplete:"off",min:1},model:{value:e.addchannel.max_memory,callback:function(a){e.$set(e.addchannel,"max_memory",e._n(a))},expression:"addchannel.max_memory"}},[n("template",{slot:"append"},[e._v("KB")])],2)],1):e._e(),e._v(" "),"MQTT"==e.addchannel.region?n("el-form-item",{staticClass:"lastchildren",staticStyle:{"margin-bottom":"10px"}},[n("span",[n("i",{staticClass:"el-icon-question"}),e._v("topic或client满足下面任意条件")])]):e._e(),e._v(" "),"MQTT"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"Topic"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"填正则表达式"},model:{value:e.addchannel.topic,callback:function(a){e.$set(e.addchannel,"topic",a)},expression:"addchannel.topic"}})],1):e._e(),e._v(" "),"MQTT"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"Client"}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"填正则表达式"},model:{value:e.addchannel.client,callback:function(a){e.$set(e.addchannel,"client",a)},expression:"addchannel.client"}})],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{attrs:{label:"主机地址",prop:"address",rules:[{required:!0,message:"输入主机地址",trigger:"blur"},{validator:e.validUrl,trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入地址"},model:{value:e.addchannel.address,callback:function(a){e.$set(e.addchannel,"address",a)},expression:"addchannel.address"}})],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"端口",prop:"port",rules:[{required:!0,trigger:"blur"},{validator:e.validPort}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入通道端口"},model:{value:e.addchannel.port,callback:function(a){e.$set(e.addchannel,"port",a)},expression:"addchannel.port"}})],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"用户名",prop:"username",rules:[{required:!0,message:"请输入用户名",trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入用户名"},model:{value:e.addchannel.username,callback:function(a){e.$set(e.addchannel,"username",a)},expression:"addchannel.username"}})],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"密码",prop:"password",rules:[{required:!0,message:"请输入密码",trigger:"blur"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入密码",type:e.pwdType},model:{value:e.addchannel.password,callback:function(a){e.$set(e.addchannel,"password",a)},expression:"addchannel.password"}},[n("template",{slot:"append"},[n("span",{staticClass:"show-pwd",staticStyle:{cursor:"pointer"},on:{click:e.showPwd}},[n("svg-icon",{attrs:{"icon-class":"password"==e.pwdType?"eye":"zheneys"}})],1)])],2)],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{staticClass:"notlastchildren",attrs:{label:"心跳(秒)",prop:"keepalive",rules:[{required:!0,message:"请输入心跳",trigger:"blur"},{type:"number",message:"心跳间隔必须为数字值"}]}},[n("el-input",{attrs:{autocomplete:"off",placeholder:"请输入心跳间隔",min:1},model:{value:e.addchannel.keepalive,callback:function(a){e.$set(e.addchannel,"keepalive",e._n(a))},expression:"addchannel.keepalive"}})],1):e._e(),e._v(" "),"MQTTCLI"==e.addchannel.region?n("el-form-item",{attrs:{label:" "}},[n("el-checkbox",{model:{value:e.addchannel.clean_start,callback:function(a){e.$set(e.addchannel,"clean_start",a)},expression:"addchannel.clean_start"}},[e._v("清除会话")]),e._v(" "),n("el-checkbox",{model:{value:e.addchannel.ssl,callback:function(a){e.$set(e.addchannel,"ssl",a)},expression:"addchannel.ssl"}},[e._v("SSL")])],1):e._e(),e._v(" "),n("el-form-item",{staticClass:"lastchildren",attrs:{label:"描述"}},[n("el-input",{attrs:{autocomplete:"off",type:"textarea",rows:3,placeholder:"请输入通道描述"},model:{value:e.addchannel.desc,callback:function(a){e.$set(e.addchannel,"desc",a)},expression:"addchannel.desc"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:e.handleClose}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(a){e.addchannelForm("addchannel")}}},[e._v("确 定")])],1)],1)],1)],1)],1)},[],!1,null,"6ad439dd",null);c.options.__file="channelManage.vue";a.default=c.exports}}]);