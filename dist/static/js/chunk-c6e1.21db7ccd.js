(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-c6e1"],{Jedr:function(e,t,a){"use strict";a.d(t,"b",function(){return i}),a.d(t,"c",function(){return s}),a.d(t,"d",function(){return l}),a.d(t,"a",function(){return r}),a.d(t,"f",function(){return o}),a.d(t,"g",function(){return c}),a.d(t,"e",function(){return u});var n=a("t3Un");function i(e,t,a,i,s){return Object(n.a)({url:"/shuwa_task/historyVcaddr",method:"get",params:{node:null,start:e,length:t,di:a,datetime:i,"search[value]":s}})}function s(){return Object(n.a)({url:"/shuwa_task/diList",method:"get"})}function l(e,t,a,i){return Object(n.a)({url:"shuwa_task/historyMeter",method:"get",params:{node:e,di:t,datetime:a,vcaddr:i}})}function r(){return Object(n.a)({url:"/shuwa_task/diList",method:"get",data:{}})}function o(e,t,a,i,s,l){return Object(n.a)({url:"/shuwa_task/vcaddr",method:"get",params:{node:e,start:t,length:a,draw:i,id:s,"search[value]":l}})}function c(e,t,a,i){return Object(n.a)({url:"shuwa_task/meter",method:"post",data:{dis:e,vcaddr:t,id:a,datetime:i}})}function u(e){return Object(n.a)({url:"/shuwa_task/readMeter",method:"post",data:{datetime:e.datetime,di:e.di,pn:e.pn,taskid:e.taskid,vcaddr:e.vcaddr,tattr:e.tattr}})}},W6Fz:function(e,t,a){"use strict";a.r(t);var n=a("4d7F"),i=a.n(n),s=a("Jedr"),l=a("fe1z"),r=(a("lTfz"),a("v0iw")),o=a.n(r),c=Math.floor(128*Math.random()+1),u={data:function(){var e=this;return{node:null,total:0,start:0,length:10,draw:1,tableData3:[],multipleSelection:[],data:function(e){var t=[];return Object(s.a)().then(function(e){e.data.map(function(e){t.push({key:e.di,label:e.di+"--"+e.name})})}),t}(),diselect:[],dialogVisible:!1,valueforsearch:"",pickerOptionsStart:{disabledDate:function(t){var a=e.endtime;return a?t.getTime()>new Date(a).getTime()&&t.getTime()>Date.now():t.getTime()<Date.now()-864e5}},pickerOptionsEnd:{disabledDate:function(t){var a=e.starttime;return a?t.getTime()<new Date(a).getTime()-864e5:t.getTime()<Date.now()-864e5}},options:[{value:"vcaddr",label:"集中器"},{value:"meter",label:"电表"}],date:[{value:"day",label:"日"},{value:"month",label:"月"},{value:"hour",label:"时"},{value:"minute",label:"分"}],spacing:[],sendup:[{value:0,label:"物理通道"},{value:1,label:"虚拟通道"}],senddown:[{value:0,label:"物理通道"},{value:1,label:"虚拟通道"}],name:"",frozendate:"",downchannel:[{type:"",interval:"",unit:"seconds"}],channel:[{label:"物理集中器",value:1},{label:"GPRS",value:2},{label:"LoRa",value:3},{label:"NB",value:4}],channeltype:"",starttime:"",meteraddress:"all",freq:"",unit:"",ftype:"vcaddr",today:"today",idselete:[],lunci:"",endtime:"",upchannel:"",loading:!0,taskobjectid:""}},mounted:function(){this.search()},methods:{timestampToTime:function(e){var t=new Date(1e3*e);return t.getFullYear()+"-"+((t.getMonth()+1<=10?"0"+(t.getMonth()+1):t.getMonth()+1)+"-")+((t.getDate()+1<=10?"0"+t.getDate():t.getDate())+" ")+((t.getHours()+1<=10?"0"+t.getHours():t.getHours())+":")+((t.getMinutes()+1<=10?"0"+t.getMinutes():t.getMinutes())+":")+(t.getSeconds()+1<=10?"0"+t.getSeconds():t.getSeconds())},removeDomain:function(e){var t=this.downchannel.indexOf(e);-1!==t&&this.downchannel.splice(t,1)},addDownChannel:function(){this.downchannel.push({type:"",interval:"",unit:"seconds"})},handleClose:function(){this.dialogVisible=!1},search:function(){var e=this;this.loading=!0;var t=o.a.Object.extend("Crond"),a=new o.a.Query(t);""!=this.valueforsearch&&a.equalTo("name",this.valueforsearch),a.equalTo("type",4),a.ascending("-updatedAt"),a.skip(this.start),a.limit(this.length),a.count().then(function(t){t&&(e.total=t),a.find().then(function(t){t&&(e.tableData3=t,e.loading=!1)})},function(t){"209"==t.code?(e.$message({type:"warning",message:"登陆权限过期，请重新登录"}),e.$router.push({path:"/login"})):119==t.code&&e.$message({type:"error",message:"没有操作权限"})})},editcrond:function(e){var t=this,a=o.a.Object.extend("Crond");new o.a.Query(a).get(e).then(function(e){t.dialogVisible=!0,t.name=e.attributes.name,t.unit=e.attributes.args.unit,t.type=e.attributes.args.pns,t.freq=e.attributes.args.freq,t.starttime=1e3*e.attributes.args.starttime,t.endtime=1e3*e.attributes.args.endtime,t.downchannel=e.attributes.args.downchannel,t.diselect=e.attributes.args.dis,t.upchannel=e.attributes.args.upchannel,t.frozendate=1e3*e.attributes.args.frozendate,t.taskobjectid=e.id,c=e.attributes.tid,t.selectchange()})},selectchange:function(){"month"==this.unit||"day"==this.unit?this.spacing=[{value:"1",label:"1"}]:"hour"==this.unit?this.spacing=[{value:"1",label:"1"},{value:"2",label:"2"},{value:"3",label:"3"},{value:"4",label:"4"},{value:"6",label:"6"},{value:"8",label:"8"},{value:"12",label:"12"}]:this.spacing=[{value:"10",label:"10"},{value:"20",label:"20"},{value:"30",label:"30"},{value:"1",label:"1"}]},handleSelectionChange:function(e){this.idselete=[],this.multipleSelection=e},handleSizeChange:function(e){this.length=e,this.search()},handleCurrentChange:function(e){this.start=(e-1)*this.length,this.search()},enddata:function(){this.endtime<=this.starttime&&(this.$message.warning("采集结束时间要小于开始时间"),this.endtime=""),this.endtime<Date.now()-2e3&&(this.$message.warning("采集结束时间要大于当前时间"),this.endtime="")},testdata:function(){this.endtime<=this.starttime&&""!=this.endtime&&null!=this.endtime&&(this.$message.warning("采集结束时间要小于开始时间"),this.starttime=""),this.starttime<Date.now()-2e3&&(this.$message.warning("采集开始时间要大于当前时间"),this.starttime="")},Meterdetail:function(e){this.$router.push({path:"/tasksmanage/schedule",query:{id:e.attributes.tid}})},convartion:function(){var e=this,t=[],a=this.meteraddress.split(",");"vcaddr"==this.ftype?a.map(function(a){t.push({vcaddr:a,dis:e.diselect})}):"all"==this.meteraddress?t.push({vcaddr:"all",dis:this.diselect}):t.push({vcaddr:"all",addr:JSON.parse(a),dis:this.diselect});var n=[],i="";i="day"==this.unit?2:"hour"==this.unit?1:"minute"==this.unit?0:"",this.downchannel.map(function(e){n.push([e.type,e.interval])});var s=o.a.Object.extend("Crond"),r=new s,u=new o.a.Query(s);""!=this.taskobjectid&&(r.id=this.taskobjectid),""!=this.frozendate?r.set("task",{di:this.diselect,chs:n,res:this.upchannel,pns:this.meteraddress,fdate:this.frozendate/1e3}):r.set("task",{di:this.diselect,chs:n,pns:this.meteraddress,res:this.upchannel}),r.set("args",{frozendate:this.frozendate/1e3,chs:n,freq:Number(this.freq),pns:this.meteraddress,unit:this.unit,cycle:this.unit,dis:this.diselect,upchannel:this.upchannel,downchannel:this.downchannel,endtime:Object(l.p)(this.endtime),starttime:Object(l.p)(this.starttime)}),r.set("active",1),r.set("type",4),r.set("name",this.name),r.set("crond",{end_time:Object(l.p)(this.endtime),freq:Number(this.freq),unit:i,start_time:Object(l.p)(this.starttime)}),r.set("tid",c),r.set("typedesc","周期任务"),""==this.taskobjectid?(u.equalTo("tid",c),u.find().then(function(t){0==t.length?r.save().then(function(t){t&&(e.$message({message:"添加成功",type:"success"}),e.dialogVisible=!1,e.name="",e.frozendate="",e.starttime="",e.endtime="",e.freq="",e.unit="",e.downchannel=[{type:"",interval:"",unit:"seconds"}]),e.frozendate="",e.diselect=[],e.upchannel=[],e.search()},function(t){"209"==t.code?(e.$message({type:"warning",message:"登陆权限过期，请重新登录"}),e.$router.push({path:"/login"})):119==t.code&&e.$message({type:"error",message:"没有操作权限"})}):e.$message({message:"任务id重复",type:"error"})})):r.save().then(function(t){t&&(e.$message({message:"编辑成功",type:"success"}),e.dialogVisible=!1,e.name="",e.frozendate="",e.starttime="",e.endtime="",e.freq="",e.unit="",c=Math.floor(128*Math.random()+1),e.taskobjectid="",e.downchannel=[{type:"",interval:"",unit:"seconds"}]),e.diselect=[],e.upchannel=[],e.search()},function(t){"209"==t.code?(e.$message({type:"warning",message:"登陆权限过期，请重新登录"}),e.$router.push({path:"/login"})):119==t.code&&e.$message({type:"error",message:"没有操作权限"})})},getfrozen:function(){},selectTime:function(e){"other"==e&&this.getfrozen()},deletetask:function(){var e=this,t=[];0!=this.multipleSelection.length?this.multipleSelection.map(function(a){t.push(new i.a(function(e,t){var n=new(o.a.Object.extend("Crond"));return n.id=a.id,n.destroy().then(function(t){e(t)},function(e){t(e.message)})})),i.a.all(t).then(function(t){e.$message({message:"删除成功",type:"success"}),t.length==e.multipleSelection.length&&e.search()}).catch(function(t){e.$message({message:t,type:"error"})})}):this.$message.warning("请勾选要删除的任务")}}},d=(a("gL6B"),a("bPS7"),a("KHd+")),h=Object(d.a)(u,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"tasklist"},[a("div",{staticClass:"top"},[a("div",{staticClass:"left"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.dialogVisible=!0}}},[e._v("配置任务")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"30px"},attrs:{type:"primary"},on:{click:e.deletetask}},[e._v("删 除")])],1),e._v(" "),a("div",{staticClass:"right"},[a("el-input",{staticStyle:{width:"200px","margin-left":"30px"},attrs:{type:"text",placeholder:"请输入任务名称"},model:{value:e.valueforsearch,callback:function(t){e.valueforsearch=t},expression:"valueforsearch"}}),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.search}},[e._v("搜 索")])],1)]),e._v(" "),a("div",{staticClass:"center"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData3,"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{label:"任务名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"采集开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.timestampToTime(t.row.attributes.args.starttime)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"数据项名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.args.dis.join(",")))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"周期单位"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.attributes.args.freq))]),e._v(" "),"day"==t.row.attributes.args.unit?a("span",[e._v("天")]):"minute"==t.row.attributes.args.unit?a("span",[e._v("分")]):"hour"==t.row.attributes.args.unit?a("span",[e._v("时")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"下发通道"},scopedSlots:e._u([{key:"default",fn:function(t){return["1"==t.row.attributes.args.downchannel?a("span",[e._v("虚拟集中器")]):a("span",[e._v("物理集中器")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.editcrond(t.row.id)}}},[e._v("编 辑")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){e.Meterdetail(t.row)}}},[e._v("详 情")])]}}])})],1),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"30px"},attrs:{background:"","page-sizes":[10,25,50,100],"page-size":e.length,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:"配置任务",visible:e.dialogVisible,width:"50%","before-close":e.handleClose,top:"5vh"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"dialog",staticStyle:{display:"flex","flex-wrap":"wrap"}},[a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("任务名称：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"请输入任务名称"},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("终端类型：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.ftype,callback:function(t){e.ftype=t},expression:"ftype"}},e._l(e.options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("采集开始时间：")]),e._v(" "),a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","picker-options":e.pickerOptionsStart},on:{change:e.testdata},model:{value:e.starttime,callback:function(t){e.starttime=t},expression:"starttime"}})],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("终端逻辑地址：")]),e._v(" "),a("el-input",{staticStyle:{width:"200px"},attrs:{type:"text",placeholder:"A终端逻辑地址,B终端逻辑地址"},model:{value:e.meteraddress,callback:function(t){e.meteraddress=t},expression:"meteraddress"}}),e._v(" "),a("p",{staticStyle:{color:"black",margin:"5px 0 0 100px",position:"absolute"}},[e._v("(all代表全部)(注意:逗号为英文逗号)")])],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("采集结束时间：")]),e._v(" "),a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择日期时间","picker-options":e.pickerOptionsEnd},on:{change:e.enddata},model:{value:e.endtime,callback:function(t){e.endtime=t},expression:"endtime"}})],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("冻结日期：")]),e._v(" "),a("el-date-picker",{attrs:{type:"date",placeholder:"当天","value-format":"timestamp"},model:{value:e.frozendate,callback:function(t){e.frozendate=t},expression:"frozendate"}})],1),e._v(" "),a("div",{staticClass:"starttime"},[a("label",{attrs:{for:""}},[e._v("采样间隔时间：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},on:{change:e.selectchange},model:{value:e.unit,callback:function(t){e.unit=t},expression:"unit"}},e._l(e.date,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.freq,callback:function(t){e.freq=t},expression:"freq"}},e._l(e.spacing,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("div",{staticClass:"children"},[a("label",{attrs:{for:""}},[e._v("上报通道：")]),e._v(" "),a("el-select",{attrs:{placeholder:"上报通道可多选",multiple:""},model:{value:e.upchannel,callback:function(t){e.upchannel=t},expression:"upchannel"}},[a("el-option",{attrs:{label:"主站",value:1}}),e._v(" "),a("el-option",{attrs:{label:"postgres",value:2}}),e._v(" "),a("el-option",{attrs:{label:"tdengine",value:3}})],1)],1),e._v(" "),a("div",{staticClass:"notchildren"},[a("label",{staticClass:"notfloat",attrs:{for:""}},[e._v("采集策略：")]),e._v(" "),e._l(e.downchannel,function(t,n){return a("div",{key:n,staticStyle:{"margin-left":"50px","margin-bottom":"10px"}},[a("label",{attrs:{for:""}},[e._v(e._s("采集轮次"+(n+1)))]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择通道类型"},model:{value:t.type,callback:function(a){e.$set(t,"type",a)},expression:"item.type"}},e._l(e.channel,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),e._v(" "),a("el-input",{staticStyle:{width:"100px"},attrs:{type:"number",min:1,placeholder:"本轮时长"},model:{value:t.interval,callback:function(a){e.$set(t,"interval",e._n(a))},expression:"item.interval"}}),e._v(" "),a("el-select",{staticStyle:{width:"100px"},attrs:{placeholder:"选择单位"},model:{value:t.unit,callback:function(a){e.$set(t,"unit",a)},expression:"item.unit"}},[a("el-option",{attrs:{label:"时",value:"hours"}}),e._v(" "),a("el-option",{attrs:{label:"分",value:"minutes"}}),e._v(" "),a("el-option",{attrs:{label:"秒",value:"seconds"}})],1),e._v(" "),a("el-link",{staticStyle:{"margin-left":"5px"},attrs:{type:"primary",underline:!1,icon:"el-icon-minus"},on:{click:function(a){a.preventDefault(),e.removeDomain(t)}}},[e._v("删除")])],1)})],2),e._v(" "),a("div",{staticClass:"children"},[a("el-link",{staticStyle:{"margin-bottom":"20px"},attrs:{icon:"el-icon-plus",type:"primary",underline:!1},on:{click:e.addDownChannel}},[e._v("添加采集策略")])],1),e._v(" "),a("div",{staticClass:"di",staticStyle:{width:"100%"}},[a("label",{attrs:{for:""}},[e._v("数据项标识：")]),e._v(" "),a("el-transfer",{attrs:{data:e.data,titles:["数据项标识","数据项标识"],"button-texts":["删除","添加"]},model:{value:e.diselect,callback:function(t){e.diselect=t},expression:"diselect"}})],1)]),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticStyle:{float:"left"},on:{click:function(t){e.dialogVisible=!1}}},[e._v("关 闭")]),e._v(" "),a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary"},on:{click:e.convartion}},[e._v("保 存")])],1)])],1)},[],!1,null,"3987c349",null);h.options.__file="tasklist.vue";t.default=h.exports},bPS7:function(e,t,a){"use strict";var n=a("e6wq");a.n(n).a},e6wq:function(e,t,a){},gL6B:function(e,t,a){"use strict";var n=a("rWnj");a.n(n).a},rWnj:function(e,t,a){}}]);