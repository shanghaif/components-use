(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1d9c"],{26:function(e,t){},27:function(e,t){},N0PP:function(e,t,n){"use strict";n.r(t);var a=n("v0iw"),l=n.n(a),o=(n("1IWx"),{data:function(){return{innerVisible:!1,allProductData:[],allProductlength:10,allProductstart:0,allProducttotal:0,productData:[],channelProductdialog:!1,productstart:0,productlength:10,producttotal:0,total:0,start:0,length:10,tableData:[],activeName:"first",channelformsearch:{name:""},channelForm:!1,addchannel:{name:"",region:"",topic:"",port:"",channeltype:""},channelId:"",addrules:{name:[{required:!0,message:"请输入通道名称",trigger:"blur"}],region:[{required:!0,message:"请选择服务类型",trigger:"change"}],channeltype:[{required:!0,message:"请选择通道类型",trigger:"change"}],topic:[{required:!0,message:"请输入topic",trigger:"blur"}],port:[{required:!0,message:"请输入侦听端口",trigger:"blur"},{type:"number",message:"端口必须为数字值"}]},productIds:[]}},mounted:function(){this.getChannel()},methods:{utc2beijing:function(e){return new Date(+new Date(e)+288e5).toISOString().replace(/T/g," ").replace(/\.[\d]{3}Z/,"")},getChannel:function(e){var t=this;0==e&&(this.start=0);var n=l.a.Object.extend("Channel"),a=new l.a.Query(n);""!=this.channelformsearch.name&&a.equalTo("name",this.channelformsearch.name),a.ascending("-createdAt"),a.skip(this.start),a.limit(this.length),a.count().then(function(e){t.total=e,a.find().then(function(e){e&&(t.tableData=e)})},function(e){t.$message.error(e.message)})},channelSizeChange:function(e){this.length=e,this.getChannel()},channelCurrentChange:function(e){this.start=(e-1)*this.length,this.getChannel()},addchannelForm:function(e){var t=this;this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;var n=l.a.Object.extend("Channel"),a=new l.a.Query(n);a.equalTo("config.port",t.addchannel.port),a.find().then(function(e){var a=new n;""!=t.channelId?a.id=t.channelId:0==e.length||t.$message({type:"warning",message:"此端口已存在"}),a.set("name",t.addchannel.name),a.set("netType",t.addchannel.region),a.set("type",t.addchannel.channeltype),a.set("desc",t.addchannel.desc),a.set("isEnable",!1),"MQTT"!=t.addchannel.region?a.set("config",{port:t.addchannel.port}):a.set("config",{topic:t.addchannel.topic}),a.save().then(function(e){e&&(t.$message({type:"success",message:"成功"}),t.$refs.addchannel.resetFields(),t.addchannel={name:"",region:"",topic:"",port:"",channeltype:""},t.channelForm=!1,t.channelId="",t.getChannel())},function(e){t.$message({type:"error",message:e.message})})})})},qyChannel:function(e){var t=this,n=new(l.a.Object.extend("Channel"));n.id=e.id,n.set("isEnable",!e.attributes.isEnable),n.save().then(function(e){e&&(t.$message({type:"success",message:"状态修改成功"}),t.getChannel())},function(e){t.$message({type:"error",message:e.message})})},updateChannel:function(e){this.channelForm=!0,this.addchannel.name=e.attributes.name,this.addchannel.region=e.attributes.netType,e.attributes.config.topic&&(this.addchannel.topic=e.attriburtes.config.topic),this.addchannel.port=e.attributes.config.port,this.addchannel.desc=e.attributes.desc,this.addchannel.channeltype=e.attributes.type,this.channelId=e.id},deleteChannel:function(e){var t=this,n=new(l.a.Object.extend("Channel"));n.id=e.row.id,n.destroy().then(function(n){t.$message({type:"success",message:"删除成功"}),e._self.$refs["popover-"+e.$index].doClose(),t.getChannel()},function(e){t.$message({type:"error",message:e.message})})}}}),s=(n("hTTn"),n("KHd+")),r=Object(s.a)(o,function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"channelmanage"},[n("h3",[e._v("服务通道管理")]),e._v(" "),n("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"设备通道("+e.total+")",name:"first"}},[n("div",{staticClass:"firsttable"},[n("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.channelformsearch,size:"small"}},[n("el-form-item",[n("el-input",{attrs:{placeholder:"请输入通道名称"},model:{value:e.channelformsearch.name,callback:function(t){e.$set(e.channelformsearch,"name",t)},expression:"channelformsearch.name"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.getChannel(0)}}},[e._v("搜 索")])],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.channelForm=!0}}},[e._v("创建通道")])],1)],1)],1),e._v(" "),n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData}},[n("el-table-column",{attrs:{label:"通道名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.name))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道地址",width:"300"},scopedSlots:e._u([{key:"header",fn:function(t){return[n("span",[n("el-tooltip",{attrs:{content:"${productId}为对应的产品Id,${addr}为对应的设备地址",placement:"top"}},[n("span",[e._v("通道路径"),n("i",{staticClass:"el-icon-question"})])])],1)]}},{key:"default",fn:function(t){return[n("span",[e._v(e._s("channel/"+t.row.attributes.name+"/${productId}/${addr}"))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"服务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("span",[e._v(e._s(t.row.attributes.netType))])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"侦听端口/TOPIC"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.attributes.config.port?n("span",[e._v(e._s(t.row.attributes.config.port))]):e._e()]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"通道状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[1==t.row.attributes.isEnable?n("span",{staticStyle:{color:"green"}},[e._v("已启用")]):n("span",[e._v("已禁用")])]}}])}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.attributes.isEnable?n("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(n){e.qyChannel(t.row)}}},[e._v("启用")]):n("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(n){e.qyChannel(t.row)}}},[e._v("禁用")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.updateChannel(t.row)}}},[e._v("编辑")]),e._v(" "),n("el-popover",{ref:"popover-"+t.$index,attrs:{placement:"top",width:"300"}},[n("p",[e._v("确定删除这个"+e._s(t.row.attributes.name)+"通道吗？")]),e._v(" "),n("div",{staticStyle:{"text-align":"right",margin:"0"}},[n("el-button",{attrs:{size:"mini"},on:{click:function(e){t._self.$refs["popover-"+t.$index].doClose()}}},[e._v("取消")]),e._v(" "),n("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(n){e.deleteChannel(t)}}},[e._v("确定")])],1),e._v(" "),n("el-button",{attrs:{slot:"reference",type:"danger",size:"mini"},slot:"reference"},[e._v("删除")])],1)]}}])})],1),e._v(" "),n("div",{staticClass:"elpagination",staticStyle:{"margin-top":"20px"}},[n("el-pagination",{attrs:{"page-sizes":[10,20,30,50],"page-size":e.length,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.channelSizeChange,"current-change":e.channelCurrentChange}})],1),e._v(" "),n("el-dialog",{attrs:{title:"新建服务通道",visible:e.channelForm,width:"40%"},on:{"update:visible":function(t){e.channelForm=t}}},[n("el-form",{ref:"addchannel",attrs:{model:e.addchannel,"label-width":"80px",rules:e.addrules}},[n("el-form-item",{attrs:{label:"通道名称",prop:"name"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.addchannel.name,callback:function(t){e.$set(e.addchannel,"name",t)},expression:"addchannel.name"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"服务类型",prop:"region"}},[n("el-select",{attrs:{placeholder:"请选择服务类型"},model:{value:e.addchannel.region,callback:function(t){e.$set(e.addchannel,"region",t)},expression:"addchannel.region"}},[n("el-option",{attrs:{label:"TCP",value:"TCP"}}),e._v(" "),n("el-option",{attrs:{label:"UDP",value:"UDP"}}),e._v(" "),n("el-option",{attrs:{label:"HTTP",value:"HTTP"}}),e._v(" "),n("el-option",{attrs:{label:"MQTT",value:"MQTT"}})],1)],1),e._v(" "),"MQTT"!=e.addchannel.region?n("el-form-item",{attrs:{label:"侦听端口",prop:"port"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.addchannel.port,callback:function(t){e.$set(e.addchannel,"port",e._n(t))},expression:"addchannel.port"}})],1):e._e(),e._v(" "),"MQTT"==e.addchannel.region?n("el-form-item",{attrs:{label:"TOPIC",prop:"topic"}},[n("el-input",{attrs:{autocomplete:"off"},model:{value:e.addchannel.topic,callback:function(t){e.$set(e.addchannel,"topic",t)},expression:"addchannel.topic"}})],1):e._e(),e._v(" "),n("el-form-item",{attrs:{label:"通道类型",prop:"channeltype"}},[n("el-select",{attrs:{placeholder:"请选择通道类型"},model:{value:e.addchannel.channeltype,callback:function(t){e.$set(e.addchannel,"channeltype",t)},expression:"addchannel.channeltype"}},[n("el-option",{attrs:{label:"采集通道",value:"1"}}),e._v(" "),n("el-option",{attrs:{label:"上报通道",value:"2"}}),e._v(" "),n("el-option",{attrs:{label:"存储通道",value:"3"}})],1)],1),e._v(" "),n("el-form-item",{attrs:{label:"描述"}},[n("el-input",{attrs:{autocomplete:"off",type:"textarea",rows:3},model:{value:e.addchannel.desc,callback:function(t){e.$set(e.addchannel,"desc",t)},expression:"addchannel.desc"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.channelForm=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addchannelForm("addchannel")}}},[e._v("确 定")])],1)],1)],1)],1)],1)},[],!1,null,"f79ba618",null);r.options.__file="channelManage.vue";t.default=r.exports},hTTn:function(e,t,n){"use strict";var a=n("nRoG");n.n(a).a},nRoG:function(e,t,n){}}]);