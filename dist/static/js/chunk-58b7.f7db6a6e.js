(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-58b7"],{"+h9D":function(e,t,a){},XPKV:function(e,t,a){"use strict";a.r(t);var r=a("t3Un");function i(e,t,a,i,o,s,n){return Object(r.a)({url:"/org/meter/hisdata",method:"get",params:{di:e,skip:t,limit:a,objectId:i,start_date:o,end_date:s,type:n}})}var o=a("gHYM"),s=a("v0iw"),n=a.n(s),l=a("7Qib"),d=a("Mz3J"),m=(a("fe1z"),a("6y/i")),h={components:{Resource1:o.a,PagingQuery:d.a},data:function(){var e=this;return{loading:!0,pager:{count:0,page:1,rows:25,name:"抄表结果展示",pages:[25,50,75],rest:0},draw:1,data:[],vcaddr:"",objId:"",obj:{frozendate:function(t,a){if("header"==t)return["冻结时间"];a.push(e.dateFtt("yyyy-MM-dd",t))},addr:"电能表地址",vcaddr:"集中器地址",task:"任务模板",datatype:"数据类型",data:function(e,t){return"header"==e?["正向有功电能总","正向有功费率1(尖)","正向有功费率1(峰)","正向有功费率1(平)","正向有功费率1(谷)"]:(t.push(e.count),t.push(e.rate1),t.push(e.rate2),t.push(e.rate3),t.push(e.rate4),t)},date:function(t,a){if("header"==t)return["采集时间"];a.push(e.dateFtt("yyyy-MM-dd hh:mm:ss",t))}},form:{vcaddr_web:"",addr_web:"",task:[{value:"05060101",label:"日冻结抄表任务"},{value:"0001FF01",label:"月冻结抄表任务"}],task_value:"05060101",data_type:[{value:"05060101",label:"历史日数据"},{value:"0001FF01",label:"历史月数据"}],data_type_value:"05060101",day_time:[new Date((new Date).getTime()-2592e5).toLocaleDateString(),new Date((new Date).getTime()).toLocaleDateString()],month_time:[new Date((new Date).getTime()-2592e6).toLocaleDateString(),new Date((new Date).getTime()).toLocaleDateString()],res:"all",startTime:"",endTime:"",pickerDisabled:{disabledDate:function(e){return e.getTime()>Date.now()}},deriveWhere:!1},table:[],search_res:[],isMeter:!1,freeze:"05060101"}},methods:{dateFtt:function(e,t){var a=new Date(1e3*t),r={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":a.getHours(),"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds()};for(var i in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length))),r)new RegExp("("+i+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?r[i]:("00"+r[i]).substr((""+r[i]).length)));return e},collTime:function(){var e=void 0,t=void 0;1==this.form.data_type_value?(e=this.StartTime(this.form.day_time),t=this.EndTime(this.form.day_time)):(e=this.StartTime(this.form.month_time),t=this.EndTime(this.form.month_time)),this.form.endTime=parseInt(t/1e3),this.form.startTime=parseInt(e/1e3)},query:function(){var e=this;this.collTime(),this.isMeter||(this.pager.page=1),""!=this.form.addr_web&&(this.isMeter=!0),function(e,t,a,i,o,s,n,l){return Object(r.a)({url:"/meter/hisdata",method:"get",params:{skip:e,limit:t,vcaddr:a,addr:i,start_date:o,end_date:s,type:n,di:l}})}((this.pager.page-1)*this.pager.rows,this.pager.rows,this.form.vcaddr_web,this.form.addr_web,this.form.startTime,this.form.endTime+85399999,this.form.res,this.freeze).then(function(t){e.search_res=t.results,e.getForDate(t),1==e.pager.page&&e.incPage(t.rest),e.pageLoading(t.rest),e.loading=!1})},StartTime:function(e){return new Date(e[0]).getTime()},EndTime:function(e){return new Date(e[1]).getTime()},reset:function(){this.form.vcaddr_web="",this.form.addr_web="",this.form.task_value=1,this.form.data_type_value=1,this.form.month_time="",this.form.day_time=[(new Date).toLocaleDateString(),(new Date).toLocaleDateString()],this.form.month_time="",this.form.res="all"},handleDateChange:function(){this.form.task_value=this.form.data_type_value,this.freeze=this.form.task_value},handleTaskChange:function(){this.form.data_type_value=this.form.task_value,this.freeze=this.form.data_type_value},getTree:function(){var e=this,t=n.a.Object.extend("Department"),a=new n.a.Query(t);a.limit(1e4),a.find().then(function(t){e.data=[],t.map(function(t){var a={};t.createtime=Object(l.a)(t.attributes.createdAt),a.name=t.attributes.name,a.ParentId=t.attributes.ParentId,a.objectId=t.id,a.createtime=t.createtime,a.icon=t.attributes.org_type,a.is_show=t.attributes.leafnode,e.data.push(a),"省电力公司"==t.attributes.name&&(e.objId=t.id)}),i(e.freeze,(e.pager.page-1)*e.pager.rows,e.pager.rows,e.objId,946659661,7258093261,e.form.res).then(function(t){e.incPage(t.rest),e.getForDate(t),e.loading=!1})},function(t){"209"==t.code&&(e.$message({type:"warning",message:"登陆权限过期，请重新登录"}),e.$router.push({path:"/login"}))})},getRows:function(e){var t=this;if(this.loading=!0,this.objId=e.objectId,this.pager.page=1,this.collTime(),this.form.addr_web="",this.form.vcaddr_web="","集中器"==e.icon)this.form.vcaddr_web=e.name,this.form.addr_web="",""==this.form.addr_web?this.isMeter=!1:(this.isMeter=!0,this.query());else if("电表"==e.icon)return this.form.addr_web=e.name,this.form.vcaddr_web="",this.isMeter=!0,void this.query();i(this.freeze,(this.pager.page-1)*this.pager.rows,this.pager.rows,this.objId,this.form.startTime,this.form.endTime+85399999,this.form.res).then(function(e){t.incPage(e.rest),t.getForDate(e),t.pager.page=1,0!=e.results.length?t.loading=!1:setTimeout(function(){t.loading=!1},1e4)})},getForDate:function(e){var t=e.results;this.table=[];for(var a=0;a<t.length;a++){var r={};r.addr_web=t[a].addr,r.vcaddr_web=t[a].vcaddr,r.data_type=t[a].datatype,r.forward_power_total=t[a].data.count,r.forward_work_rate_1=t[a].data.rate1,r.forward_work_rate_2=t[a].data.rate2,r.forward_work_rate_3=t[a].data.rate3,r.forward_work_rate_4=t[a].data.rate4,r.freeze_time=this.dateFtt("yyyy-MM-dd",t[a].frozendate),r.gather_time=this.dateFtt("yyyy-MM-dd hh:mm:ss",t[a].date),r.inversion_power_total=t[a].data.NotCount,r.task_value=t[a].task,r.inversion_power_total=this.isNot(r.inversion_power_total),r.gather_time=this.isNot(r.gather_time),r.addr_web=this.isNot(r.addr_web),r.vcaddr_web=this.isNot(r.vcaddr_web),r.forward_power_total=this.isNot(r.forward_power_total),r.forward_work_rate_1=this.isNot(r.forward_work_rate_1),r.forward_work_rate_2=this.isNot(r.forward_work_rate_2),r.forward_work_rate_3=this.isNot(r.forward_work_rate_3),r.forward_work_rate_4=this.isNot(r.forward_work_rate_4),r.task=this.isNot(r.task),this.table.push(r)}},isNot:function(e){return void 0==e?"-":e},setup:function(e){this.getinformation(e)},getinformation:function(e){var t=this;this.loading=!0,""!=this.objId&&(this.isMeter?this.query():(this.collTime(),i(this.freeze,(this.pager.page-1)*this.pager.rows,this.pager.rows,this.objId,this.form.startTime,this.form.endTime+85399999,this.form.res).then(function(e){t.getForDate(e),t.pageLoading(e.rest),t.loading=!1}).catch(function(e){console.log(e)})))},setup2:function(e){this.get_now(e)},get_now:function(e){var t=this;this.collTime(),i(this.freeze,(this.pager.page-1)*this.pager.rows,this.pager.rows,this.objId,this.form.startTime,this.form.endTime,this.form.res).then(function(e){t.search_res?m.a.$emit("drive",{json:t.search_res,obj:t.obj,name:t.pager.name}):m.a.$emit("drive",{json:e.results,obj:t.obj,name:t.pager.name})}).catch(function(e){console.log(e)})},getdeive:function(e){var t=this;this.collTime(),i(this.freeze,e.start,this.pager.rows*(e.end-e.start+1),this.objId,this.form.startTime,this.form.endTime,this.form.res).then(function(e){t.search_res?m.a.$emit("drive",{json:t.search_res,obj:t.obj,name:t.pager.name}):m.a.$emit("drive",{json:e.results,obj:t.obj,name:t.pager.name})})},pageLoading:function(e){this.pager.count/this.pager.rows===this.pager.page&&(this.pager.rest+=e,this.pager.count=this.pager.rest*this.pager.rows)},incPage:function(e){this.pager.rest=e,this.pager.count=this.pager.rows*this.pager.rest},totalHide:function(){document.getElementsByClassName("el-pagination__total")[0].style.display="none"}},mounted:function(){this.totalHide(),this.getTree(),this.getinformation()}},_=(a("lx9N"),a("KHd+")),c=Object(_.a)(h,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:"meter_reading"}},[a("div",{staticClass:"menu"},[a("Resource1",{on:{meterdetail:e.getRows}})],1),e._v(" "),a("div",{staticClass:"content"},[a("el-form",{ref:"form",attrs:{model:e.form}},[a("el-form-item",{attrs:{label:"集中器地址"}},[a("el-input",{model:{value:e.form.vcaddr_web,callback:function(t){e.$set(e.form,"vcaddr_web",t)},expression:"form.vcaddr_web"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"电能表地址"}},[a("el-input",{model:{value:e.form.addr_web,callback:function(t){e.$set(e.form,"addr_web",t)},expression:"form.addr_web"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"任务模板"}},[a("el-select",{attrs:{placeholder:"请选择任务模板"},on:{change:e.handleTaskChange},model:{value:e.form.task_value,callback:function(t){e.$set(e.form,"task_value",t)},expression:"form.task_value"}},e._l(e.form.task,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"数据类型"}},[a("el-select",{attrs:{placeholder:"请选择数据类型"},on:{change:e.handleDateChange},model:{value:e.form.data_type_value,callback:function(t){e.$set(e.form,"data_type_value",t)},expression:"form.data_type_value"}},e._l(e.form.data_type,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"抄表结果"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.form.res,callback:function(t){e.$set(e.form,"res",t)},expression:"form.res"}},[a("el-option",{attrs:{label:"全部",value:"all"}}),e._v(" "),a("el-option",{attrs:{label:"成功",value:"success"}}),e._v(" "),a("el-option",{attrs:{label:"失败",value:"fail"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"采集时间"}},["05060101"==e.form.data_type_value?a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","picker-options":e.form.pickerDisabled},model:{value:e.form.day_time,callback:function(t){e.$set(e.form,"day_time",t)},expression:"form.day_time"}}):"0001FF01"==e.form.data_type_value?a("el-date-picker",{attrs:{type:"monthrange","range-separator":"至","start-placeholder":"开始月份","end-placeholder":"结束月份","picker-options":e.form.pickerDisabled},model:{value:e.form.month_time,callback:function(t){e.$set(e.form,"month_time",t)},expression:"form.month_time"}}):e._e()],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.query}},[e._v("查询")]),e._v(" "),a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:e.reset}},[e._v("重置")])],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中",data:e.table,height:"650",border:""}},[a("el-table-column",{attrs:{prop:"freeze_time",label:"冻结时间",width:"150"}}),e._v(" "),a("el-table-column",{attrs:{prop:"addr_web",label:"电能表地址",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"vcaddr_web",label:"集中器地址",width:"130"}}),e._v(" "),a("el-table-column",{attrs:{prop:"task",label:"任务模板",width:"100"}}),e._v(" "),a("el-table-column",{attrs:{prop:"data_type",label:"数据类型",width:"180"}}),e._v(" "),a("el-table-column",{attrs:{prop:"forward_power_total",label:"正向有功电能总",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"forward_work_rate_1",label:"正向有功费率1(尖)",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"forward_work_rate_2",label:"正向有功费率2(峰)",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"forward_work_rate_3",label:"正向有功费率3(平)",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"forward_work_rate_4",label:"正向有功费率4(谷)",width:"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"gather_time",label:"采集时间",width:"190"}})],1),e._v(" "),a("PagingQuery",{attrs:{pager:e.pager},on:{setPager:e.getinformation,query:e.setup,now_drive:e.setup2,alldrive:e.getdeive}})],1)])},[],!1,null,"89f75dac",null);c.options.__file="meterReading.vue";t.default=c.exports},lx9N:function(e,t,a){"use strict";var r=a("+h9D");a.n(r).a}}]);