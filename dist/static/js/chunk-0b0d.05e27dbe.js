(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-0b0d"],{MVgM:function(e,t,a){},lzw9:function(e,t,a){"use strict";a.d(t,"d",function(){return r}),a.d(t,"e",function(){return i}),a.d(t,"a",function(){return o}),a.d(t,"c",function(){return s}),a.d(t,"b",function(){return l});var n=a("t3Un");function r(e,t){return Object(n.a)({url:"/pump/templet?dataType=pump_report&start="+e+"&len="+t,method:"GET",data:{}})}function i(e){return Object(n.a)({url:"/pump/templet/"+e,method:"GET",data:{}})}function o(e,t){return Object(n.a)({url:"/pump/templet",method:"POST",data:{data:e,id:t,dataType:"pump_report"}})}function s(){return Object(n.a)({url:"/pump/templet?dataType=pump_report&start=0&len=1000",method:"GET",data:{}})}function l(e){return Object(n.a)({url:"/pump/report/config?reportId="+e,method:"GET",data:{}})}},t9JG:function(e,t,a){"use strict";var n=a("MVgM");a.n(n).a},zs8C:function(e,t,a){"use strict";a.r(t);var n=a("gDS+"),r=a.n(n),i=a("v0iw"),o=a.n(i),s=a("lzw9"),l={data:function(){var e=this;return{pickerOptionsStart:{disabledDate:function(t){var a=e.form.endtime;return a&&t.getTime()>new Date(a).getTime()||t.getTime()<Date.now()-864e5}},pickerOptionsEnd:{disabledDate:function(t){var a=e.form.starttime;return a?t.getTime()<new Date(a).getTime()-864e5:t.getTime()<Date.now()-864e5}},taskData:[],pagesize:10,start:0,total:0,standard:"",form:{starttime:"",endtime:"",inspection_number:"",client:"",region:"",produt:"",model:"",standard:[],testbed:[],bedname:""},options:[{value:"浙江利欧",label:"浙江利欧"},{value:"南方泵业",label:"南方泵业"},{value:"新界泵业",label:"新界泵业"},{value:"丰球",label:"丰球"}],formLabelWidth:"120px",taskdialog:!1,formrule:{inspection_number:[{required:!0,message:"请输入检验编号",trigger:"blur"}],client:[{required:!0,message:"请选择委托单位",trigger:"change"}],region:[{required:!0,message:"请选择检验标准",trigger:"change"}],produt:[{required:!0,message:"请输入产品名称",trigger:"blur"}],model:[{required:!0,message:"请输入水泵型号",trigger:"blur"}],bedname:[{required:!0,message:"请选择测试台体",trigger:"change"}],starttime:[{type:"date",required:!0,message:"请选择开始时间",trigger:"change"}],endtime:[{type:"date",required:!0,message:"请选择结束时间",trigger:"change"}]}}},created:function(){},mounted:function(){this.getTasktable(this.pagesize,this.start)},methods:{getTasktable:function(e,t){var a=this;this.taskData=[];var n=o.a.Object.extend("Report"),i=new o.a.Query(n);i.descending("createdAt"),i.limit(e),i.skip(t),i.count().then(function(e){a.total=e,i.find().then(function(e){e.map(function(e){var t={};t=JSON.parse(r()(e));var n=o.a.Object.extend("Testbed");new o.a.Query(n).get(e.attributes.testbed).then(function(e){t.updatedAt=e.attributes.name}),a.taskData.push(t)}),console.log(a.taskData)})},function(e){console.log(e),a.$message({type:"error",message:e.message})})},addtask:function(){var e=this;this.taskdialog=!0;var t=o.a.Object.extend("Testbed");new o.a.Query(t).find().then(function(t){e.form.testbed=t}),Object(s.c)().then(function(t){t&&(e.form.standard=t.data)}).catch(function(t){e.$message({type:"error",message:t.error})})},handleSizeChange:function(e){this.pagesize=e},handleCurrentChange:function(e){this.start=Number(e-1)*Number(this.pagesize)},taskDetail:function(e,t){this.$router.push({path:"/inspection/reportdetail",query:{id:e,testbedid:t}})},standardName:function(){var e,t=this;e=this.form.standard.find(function(e){return r()(e.data)===t.form.region}),this.standard=e.data.inspection_standard},addBedtask:function(e){var t=this;this.$refs[e].validate(function(e){if(e){var a=new(o.a.Object.extend("Report"));a.set("inspection_number",t.form.inspection_number),a.set("client",t.form.client),a.set("produt",t.form.produt),a.set("model",t.form.model),a.set("testbed",t.form.bedname),a.set("standard",t.standard),a.set("datas",JSON.parse(t.form.region)),a.set("start_time",t.form.starttime/1e3),a.set("end_time",t.form.endtime/1e3),a.save().then(function(e){t.$message({message:"新增成功",type:"success"}),t.taskdialog=!1,t.getTasktable(t.pagesize,t.start)},function(e){t.$message({type:"error",message:e.message})})}})},derive:function(e){Object(s.b)(e).then(function(e){})},enddata:function(){this.form.endtime<=this.form.starttime&&(this.$message.warning("任务结束时间要小于开始时间"),this.form.endtime=""),this.form.endtime<Date.now()-2e3&&(this.$message.warning("任务结束时间要大于当前时间"),this.form.endtime="")},testdata:function(){this.form.endtime<=this.form.starttime&&""!=this.form.endtime&&null!=this.form.endtime&&(this.$message.warning("任务开始时间要小于结束时间"),this.form.starttime=""),this.form.starttime<Date.now()-2e3&&(this.$message.warning("任务开始时间要大于当前时间"),this.form.starttime="")}}},d=(a("t9JG"),a("KHd+")),m=Object(d.a)(l,function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"inspection"},[a("div",{staticClass:"addtask"},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addtask()}}},[e._v("新增任务")])],1),e._v(" "),a("div",{staticClass:"tasklist"},[a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:e.taskData,stripe:"",border:""}},[a("el-table-column",{attrs:{type:"index",label:"id"}}),e._v(" "),a("el-table-column",{attrs:{label:"检验编号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.inspection_number))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"委托单位",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.client))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"产品名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.produt))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"水泵型号",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.model))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"测试台体",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.updatedAt))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"检验标准",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.standard))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"创建日期",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(new Date(t.row.createdAt).toLocaleDateString()))])]}}])}),e._v(" "),a("el-table-column",{attrs:{width:"200",label:"查看",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(a){e.taskDetail(t.row.objectId,t.row.testbed)}}},[e._v("详情")])]}}])})],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-pagination",{attrs:{"page-sizes":[10,20,30,40],"page-size":e.pagesize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{staticClass:"block"},[a("el-dialog",{attrs:{title:"新增检测任务",visible:e.taskdialog,width:"30%"},on:{"update:visible":function(t){e.taskdialog=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.formrule}},[a("el-form-item",{attrs:{label:"检验编号：","label-width":e.formLabelWidth,prop:"inspection_number"}},[a("el-input",{attrs:{placeholder:"请输入检验编号"},model:{value:e.form.inspection_number,callback:function(t){e.$set(e.form,"inspection_number",t)},expression:"form.inspection_number"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"委托单位：","label-width":e.formLabelWidth,prop:"client"}},[a("el-select",{attrs:{placeholder:"请选择委托单位"},model:{value:e.form.client,callback:function(t){e.$set(e.form,"client",t)},expression:"form.client"}},e._l(e.options,function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"产品名称：","label-width":e.formLabelWidth,prop:"produt"}},[a("el-input",{attrs:{placeholder:"请选择产品名称"},model:{value:e.form.produt,callback:function(t){e.$set(e.form,"produt",t)},expression:"form.produt"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"水泵型号：","label-width":e.formLabelWidth,prop:"model"}},[a("el-input",{attrs:{placeholder:"请输入泵型号"},model:{value:e.form.model,callback:function(t){e.$set(e.form,"model",t)},expression:"form.model"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"检验标准：","label-width":e.formLabelWidth,prop:"region"}},[a("el-select",{attrs:{placeholder:"请选择检验标准"},on:{change:function(t){e.standardName()}},model:{value:e.form.region,callback:function(t){e.$set(e.form,"region",t)},expression:"form.region"}},e._l(e.form.standard,function(e,t){return a("el-option",{key:t,attrs:{label:e.data.inspection_standard,value:JSON.stringify(e.data)}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"测试台体：","label-width":e.formLabelWidth,prop:"bedname"}},[a("el-select",{attrs:{placeholder:"请选择测试台体"},model:{value:e.form.bedname,callback:function(t){e.$set(e.form,"bedname",t)},expression:"form.bedname"}},e._l(e.form.testbed,function(e,t){return a("el-option",{key:t,attrs:{label:e.attributes.name,value:e.id}})}))],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间：","label-width":e.formLabelWidth,prop:"starttime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择开始时间","picker-options":e.pickerOptionsStart,"value-format":"timestamp"},on:{change:e.testdata},model:{value:e.form.starttime,callback:function(t){e.$set(e.form,"starttime",t)},expression:"form.starttime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间：","label-width":e.formLabelWidth,prop:"endtime"}},[a("el-date-picker",{attrs:{type:"datetime",placeholder:"选择结束时间","picker-options":e.pickerOptionsEnd,"value-format":"timestamp"},on:{change:e.enddata},model:{value:e.form.endtime,callback:function(t){e.$set(e.form,"endtime",t)},expression:"form.endtime"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.taskdialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addBedtask("form")}}},[e._v("确 定")])],1)],1)],1)],1)])},[],!1,null,"3db5e29c",null);m.options.__file="Inspection.vue";t.default=m.exports}}]);