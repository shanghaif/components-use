(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-b6fc"],{"4Ihb":function(t,e,a){"use strict";var n=a("be5q");a.n(n).a},"8CWs":function(t,e,a){"use strict";a.r(e);var n=a("YEIV"),i=a.n(n),s=a("v0iw"),o=a.n(s),r=(a("lTfz"),a("t3Un"));var l=a("WAOP"),c={inject:["reload"],data:function(){var t;return t={reportid:"",myChart:null,datafortable:[],dialogVisible:!1,action:"",data:{},show:!1,tasknameid:"",tetbedid:"",tableData1:[],Datafile:[]},i()(t,"tasknameid",""),i()(t,"row",0),t},mounted:function(){this.getReportdetail(),this.Getchart(),this.init()},methods:{utc2beijing:function(t){var e=new Date(t);return e.getFullYear()+"-"+((e.getMonth()+1<=10?"0"+(e.getMonth()+1):e.getMonth()+1)+"-")+((e.getDate()+1<=10?"0"+e.getDate():e.getDate())+" ")+((e.getHours()+1<=10?"0"+e.getHours():e.getHours())+":")+((e.getMinutes()+1<=10?"0"+e.getMinutes():e.getMinutes())+":")+(e.getSeconds()+1<=10?"0"+e.getSeconds():e.getSeconds())},init:function(){var t=this;setTimeout(function(){window.addEventListener("resize",function(){t.myChart.resize()})},20)},getReportdetail:function(){var t=this;this.reportid=this.$route.query.id,this.testbedid=this.$route.query.testbedid,this.Datafile=[];var e=o.a.Object.extend("Report");new o.a.Query(e).get(this.reportid).then(function(e){var a=e.attributes.datas.inspecting;t.datafortable=[],a.map(function(e){e.guarantee_value.map(function(a){a.inspecting_item=e.inspecting_item,a.type="imgage",t.datafortable.push(a)})})},function(e){t.$message({type:"error",message:e.message})})},Getchart:function(t,e,a){var n=document.getElementById("Getdata");this.myChart=this.$echarts.init(n);var i=["#5793f3","#d14a61","#675bba"];this.myChart.setOption({color:i,tooltip:{trigger:"axis",axisPointer:{show:!0,type:"cross",lineStyle:{type:"dashed",width:1}}},toolbox:{show:!0},grid:{left:"10%"},xAxis:[{type:"value",axisTick:{alignWithLabel:!0,show:!0,interval:10},splitLine:{show:!0},boundaryGap:!1,name:"Q(m³/h)",nameTextStyle:{color:"red",padding:[10,-5,0,0]}}],yAxis:[{type:"value",name:"H(m)",position:"left",axisLine:{lineStyle:{color:i[0]}},axisLabel:{formatter:"{value}"},splitNumber:5,axisTick:{show:!1}},{type:"value",name:"P(kW)",position:"left",offset:50,splitLine:{show:!1},axisLine:{lineStyle:{color:i[1]}},axisLabel:{formatter:"{value}"},splitNumber:5},{type:"value",name:"η(%)",splitNumber:5,splitLine:{show:!1},position:"right",axisLine:{lineStyle:{color:i[2]}},axisLabel:{formatter:"{value}"},smooth:!0}],series:[{name:"扬程",type:"line",smooth:!0,yAxisIndex:0,data:t},{name:"功率",type:"line",smooth:!0,yAxisIndex:1,data:e},{name:"效率",type:"line",smooth:!0,yAxisIndex:2,data:a}]})},startPump:function(t){var e=this,a=this;Object(l.b)(t,"start",this.reportid).then(function(t){e.$message({type:"success",message:"成功启动"}),a.reload()})},stopPump:function(t){var e=this,a=this;Object(l.b)(t,"stop",this.reportid).then(function(t){e.$message({type:"success",message:"成功停止"}),a.reload()})},rowExpand:function(t){var e=this;this.row=t,this.tasknameid=t.id,this.Datafile=[];var a=o.a.Object.extend("PumpData"),n=new o.a.Query(a);n.equalTo("itemId",this.tasknameid.toString()),n.equalTo("reportId",this.reportid),n.find().then(function(t){t.map(function(t){"file"==t.attributes.data.type&&e.Datafile.push(t)})})},detail:function(t){console.log(t),Object(l.a)(t).then(function(t){window.open(t.url)})},deleteimg:function(t){var e=this,a=o.a.Object.extend("PumpData");new o.a.Query(a).get(t).then(function(t){t.destroy().then(function(t){e.$message({type:"success",message:"删除成功"}),e.rowExpand(e.row)},function(t){console.log(t)})})},flatEvidence:function(t){this.dialogVisible=!0,this.tasknameid=t},consoleEvidenvce:function(t,e){var a=this,n=o.a.Object.extend("Testbed");new o.a.Query(n).get(this.testbedid).then(function(t){var e=t.relation("relation").query();e.equalTo("basedata.type","PC"),e.find().then(function(t){a.tableData1=t})})},handleRemove:function(t,e){console.log(t,e)},handlePreview:function(t){console.log(t)},getFilename:function(t){this.data.name=t.name},deleteFile:function(){this.$refs.upload.clearFiles(),this.dialogVisible=!1},submitUpload:function(){var t=this;location.hostname;Object(r.a)({url:"/file/signature?type=aliyun",method:"get",params:{}}).then(function(e){var a=e;t.action=a.host,t.$nextTick(function(){t.data.callback=a.callback,t.data.key=a.dir+"${filename}",t.data.policy=a.policy,t.data.OSSAccessKeyId=a.accessid,t.data.signature=a.signature,t.$refs.upload.submit()})},function(e){t.$message({})}).catch(function(t){console.log(t)})},responsesuccess:function(){this.$message({type:"success",message:"上传成功"})},importdata:function(){var t=this,e=new(o.a.Object.extend("CloudFile"));e.set("type","file"),e.set("source","aliyun"),e.set("action","web"),e.set("filepath",{bucket:"shuwapump",end_point:"oss-cn-shanghai.aliyuncs.com",object_name:this.data.name}),e.save().then(function(e){var a=new(o.a.Object.extend("PumpData"));a.set("data",{type:"file",data:e.id,source:"web"}),a.set("type","web");var n=new(o.a.Object.extend("Report"));n.set("objectId",t.reportid),a.set("reportId",n),a.set("itemId",t.tasknameid.toString()),a.save().then(function(e){t.$message({type:"success",message:"上传成功!"}),t.dialogVisible=!1},function(t){console.log(t)})},function(t){console.log(t)})},controllerEvidence:function(t,e){var a=this,n=o.a.Object.extend("Testbed");new o.a.Query(n).get(this.testbedid).then(function(t){var e=t.relation("relation").query();e.equalTo("basedata.type","DTU"),e.find().then(function(t){a.tableData1=t})})},liveEvidence:function(t,e){var a=this,n=o.a.Object.extend("Testbed");new o.a.Query(n).get(this.testbedid).then(function(t){var e=t.relation("relation").query();e.equalTo("basedata.type","CAMERA"),e.find().then(function(t){a.tableData1=t})})},Gotodetail:function(t,e){"PC"==t?this.$router.push({path:"console_evidence",query:{type:t,taskid:e,reportId:this.reportid,tasknameid:this.tasknameid}}):"DTU"==t?this.$router.push({path:"controller_evidence",query:{type:t,taskid:e,reportId:this.reportid,tasknameid:this.tasknameid}}):this.$router.push({path:"live_evidence",query:{type:t,taskid:e,reportId:this.reportid,tasknameid:this.tasknameid}})}}},u=(a("4Ihb"),a("nZTg"),a("KHd+")),d=Object(u.a)(c,function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"reportdetail"},[a("div",{staticClass:"block"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.datafortable,stripe:""},on:{"expand-change":function(e){t.rowExpand(e)}}},[a("el-table-column",{attrs:{type:"expand",label:"取证",width:"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-form",{staticClass:"demo-table-expand",staticStyle:{"margin-bottom":"10px"},attrs:{"label-position":"bottom",inline:""}},[a("el-button",{on:{click:function(a){t.flatEvidence(e.row.id)}}},[t._v("平板取证")]),t._v(" "),a("el-button",{on:{click:function(a){t.consoleEvidenvce(e.row.id,t.reportid)}}},[t._v("控制台取证")]),t._v(" "),a("el-button",{on:{click:function(a){t.controllerEvidence(e.row.id,t.reportid)}}},[t._v("控制器取证")]),t._v(" "),a("el-button",{on:{click:function(a){t.liveEvidence(e.row.id,t.reportid)}}},[t._v("摄像头取证")])],1),t._v(" "),a("el-table",{staticStyle:{width:"100%","text-align":"center"},attrs:{data:t.tableData1}},[a("el-table-column",{attrs:{label:"设备名称",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["PC"==e.row.attributes.basedata.type?a("span",[t._v("控制台")]):"DTU"==e.row.attributes.basedata.type?a("span",[t._v("控制器")]):a("span",[t._v("摄像头")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"设备编号",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.attributes.devaddr))])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"运行状态",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return["offline"==e.row.attributes.basedata.status?a("span",{staticStyle:{color:"red"}},[t._v("离线")]):"running"==e.row.attributes.basedata.status?a("span",{staticStyle:{color:"green"}},[t._v("忙碌")]):a("span",{staticStyle:{color:"green"}},[t._v("在线")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(a){t.Gotodetail(e.row.attributes.basedata.type,e.row.id)}}},[t._v("详情")]),t._v(" "),"ready"==e.row.attributes.basedata.status?a("el-button",{attrs:{size:"mini",type:"success"},on:{click:function(a){t.startPump(e.row.attributes.devaddr)}}},[t._v("启动")]):t._e(),t._v(" "),"running"==e.row.attributes.basedata.status?a("el-button",{attrs:{size:"mini",type:"danger"},on:{click:function(a){t.stopPump(e.row.attributes.devaddr)}}},[t._v("停止")]):t._e()]}}])})],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"id",label:"序号",width:"180"}}),t._v(" "),a("el-table-column",{attrs:{prop:"inspecting_item",label:"检验项目"}}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"保证值"}}),t._v(" "),a("el-table-column",{attrs:{prop:"value",label:"测试值"}}),t._v(" "),a("el-table-column",{attrs:{prop:"",label:"评定"}})],1)],1),t._v(" "),a("el-col",{staticStyle:{"min-height":"875px","border-left":"1px solid blue"},attrs:{xs:24,sm:24,md:12,lg:12,xl:12}},[a("div",{staticStyle:{width:"100%",height:"300px"},attrs:{id:"Getdata"}}),t._v(" "),a("el-table",{staticClass:"tableforfile",staticStyle:{width:"100%","text-align":"center"},attrs:{data:t.Datafile}},[a("el-table-column",{attrs:{label:"数据来源",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(e.row.attributes.data.source))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"最近更新时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t.utc2beijing(e.row.attributes.createdAt)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{align:"center",label:"内容"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"success"},on:{click:function(a){t.detail(e.row.attributes.data.data)}}},[t._v("查 看")]),t._v(" "),a("el-button",{attrs:{type:"danger"},on:{click:function(a){t.deleteimg(e.row.id)}}},[t._v("删 除")])]}}])})],1)],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"40%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[a("div",{staticStyle:{"margin-top":"10px"}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:t.action,data:t.data,limit:1,"on-preview":t.handlePreview,"on-remove":t.handleRemove,"before-upload":t.getFilename,"on-success":t.responsesuccess,"auto-upload":!1}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t._v("选取文件")]),t._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:t.submitUpload}},[t._v("上传到服务器")]),t._v(" "),a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.importdata}},[t._v("提 交")])],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:t.deleteFile}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:t.deleteFile}},[t._v("确 定")])],1)])],1)},[],!1,null,"07ad9b36",null);d.options.__file="reportdetail.vue";e.default=d.exports},WAOP:function(t,e,a){"use strict";a.d(e,"b",function(){return o}),a.d(e,"c",function(){return r}),a.d(e,"d",function(){return l}),a.d(e,"a",function(){return c}),a.d(e,"e",function(){return u});var n=a("YEIV"),i=a.n(n),s=a("t3Un");function o(t,e,a){return Object(s.a)({url:"/pump/device/"+t,method:"post",params:{action:e,reportId:a},data:{}})}function r(t,e,a){return Object(s.a)({url:"/pump/report/actual",method:"get",params:{reportId:t,type:e,draw_type:a}})}function l(t,e,a,n){return Object(s.a)({url:"/pump/data/average",method:"put",params:{reportId:t,type:e,start:a,end:n}})}function c(t){return Object(s.a)({url:"/pump/cloud_file",method:"get",params:i()({objectid:t},"objectid",t)})}function u(t,e,a){return Object(s.a)({url:"/pump/livestream",method:"get",params:{app:t,stream:e,endtime:a}})}},be5q:function(t,e,a){},nZTg:function(t,e,a){"use strict";var n=a("wzLN");a.n(n).a},wzLN:function(t,e,a){}}]);